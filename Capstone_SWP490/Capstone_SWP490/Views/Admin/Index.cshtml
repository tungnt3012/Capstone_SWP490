@model Capstone_SWP490.page_content
@{
    ViewBag.Title = "Home Page";
}

<style>
    #menu-rules {
        color: #ffffff !important;
        background: #30cf6b;
    }

    body {
        background-color: #ffffff;
    }

    .title {
        width: 90vw;
        height: fit-content;
        color: white;
        font-size: 2rem;
        font-family: 'Playfair Display', serif;
        font-weight: 800;
    }

    .input {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: start;
        gap: 2rem;
        padding: 1rem;
        border: 1px solid #000000;
        height: 4.2rem;
        overflow: hidden;
        transition: height 1s ease;
        max-width: 50rem;
        background: #ffffff;
        margin-left: 20px;
    }

    #close {
        margin-left: auto;
        margin-top: -0.5rem;
        margin-right: -0.7rem;
        display: none;
    }

    .input .inputs1 {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        width: 100%;
    }

    .inputs2 textarea {
        display: none;
        max-width: 50rem;
        min-width: 40rem;
    }

    .input .heading {
        width: 35em;
        height: 2rem;
        background-color: transparent;
        border: none;
        outline: none;
        color: #000000;
        font-family: 'Playfair Display', serif;
    }

    .input button {
    }

        .input button:hover {
            background-color: white;
            color: black;
            font-weight: bold;
        }


    .subcon {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

        .subcon:nth-child(1) {
            grid-column-start: 1;
            grid-column-end: 2;
        }

        .subcon:nth-child(2) {
            grid-column-start: 2;
            grid-column-end: 3;
        }

        .subcon:nth-child(3) {
            grid-column-start: 3;
            grid-column-end: 4;
        }

        .subcon:nth-child(4) {
            grid-column-start: 4;
            grid-column-end: 5;
        }

        .subcon:nth-child(5) {
            grid-column-start: 5;
            grid-column-end: 6;
        }

    .item {
        border: 1px solid white;
        padding: 0.8rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

        .item #heading {
            font-weight: bold;
            font-size: 1.5em !important;
        }

        .item #delete_edit img {
            height: 1.5rem;
            margin-top: 1rem;
            margin-right: 0.5rem;
        }

    #post-pins {
        width: auto;
        height: auto;
        background-color: #007bff;
        border: none;
        color: #ffffff;
        /* font-family: 'Playfair Display', serif; */
        text-transform: uppercase;
        margin-left: auto;
        margin-top: 10px;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,700;1,800&family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
<script src="//cdn.ckeditor.com/4.17.1/standard/ckeditor.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<div class="container-fluid xyz">
    <div class="col-lg-12" id="content_area2_header">
        <div class="col-lg-12" id="content_area2_title">
            <label for="exampleInputTitle">administrators Rules</label>
        </div>
    </div>
    <div class="main">
        <div class="col-lg-12" id="col-local">

            <div class="input">
                <img id="close" src="~/image/x-circle-fill.svg" />
                <div class="inputs1">
                    <input class="heading" type="text" placeholder="More information...">
                    <button class="save_btn">Add</button>
                    <button style="display: none" class="update_btn">Done</button>
                </div>
                <div class="inputs2">
                    <textarea id="editor" name="content" placeholder="Puke your Content in here! 🤮"></textarea>
                    <button type="button" class="btn btn-primary" id="post-pins">Post Pins</button>
                </div>
            </div>
            <button class="btn btn-primary pull-right" onclick="AjaxSaveListContent()" id="btnSaveContent">Update All</button>

            <div class="container">
                @*@using (Html.BeginForm("UpdatePageContent", "Admin", "POST"))
                    {
                    }*@
                <div class="column subcon" id="page-content">
                </div>

                @*<div class="subcon">
                        <div class="item">
                            <span id="heading" class="sonam">The Contest</span>
                            <span id="content">
                                <p>Ten (10) or more algorithmic problems will be posed for teams to solve in five (5) hours. While the contest is scheduled for five hours, the Regional Contest Director has the authority to alter the length of the contest in the even of unforeseen difficulties. Should the contest duration be altered, every attempt will be made to notify contestants in a timely and uniform manner.</p>

                                <p>Problems will be posed in English. During the contest , all communications from contest officials to contestants will be in English.</p>

                                <p>A contestant may submit a claim of ambiguity or error in a problem statement by submitting a clarification request using the contest management system. If the judges agree that ambiguity is present in the problem, a broadcast of the clarification will be made to all teams.</p>

                                <p>Should a contestant require use of the restroom during the contest proper, the contestant will be accompanied by a designated usher.</p>

                            </span>
                            <span id="delete_edit">
                                <img id="edit" src="~/image/pencil-fill.svg" />
                                <img id="delete" src="~/image/trash-fill.svg" />
                            </span>
                        </div>
                    </div>
                    <div class="subcon">
                        <div class="item">
                            <span id="heading">Submissions</span>
                            <span id="content">
                                Ten (10) or more algorithmic problems will be posed for teams to solve in five (5) hours. While the contest is scheduled
                                for five hours, the Regional Contest Director has the authority to alter the length of the contest in the even of unforeseen
                                difficulties. Should the contest duration be altered, every attempt will be made to notify contestants in a timely and
                                uniform manner.
                            </span>
                            <span id="delete_edit">
                                <img id="edit" src="~/image/pencil-fill.svg" />
                                <img id="delete" src="~/image/trash-fill.svg" />
                            </span>
                        </div>

                    </div>
                    <div class="subcon">
                        <div class="item">
                            <span id="heading">Scoring and Ranks</span>
                            <span id="content">
                                Ten (10) or more algorithmic problems will be posed for teams to solve in five (5) hours. While the contest is scheduled
                                for five hours, the Regional Contest Director has the authority to alter the length of the contest in the even of unforeseen
                                difficulties. Should the contest duration be altered, every attempt will be made to notify contestants in a timely and
                                uniform manner.
                            </span> <span id="delete_edit">
                                <img id="edit" src="~/image/pencil-fill.svg" />
                                <img id="delete" src="~/image/trash-fill.svg" />
                            </span>
                        </div>

                    </div>
                    <div class="subcon">
                        <div class="item">
                            <span id="heading">Contestant Conduct</span>
                            <span id="content">
                                Ten (10) or more algorithmic problems will be posed for teams to solve in five (5) hours. While the contest is scheduled
                                for five hours, the Regional Contest Director has the authority to alter the length of the contest in the even of unforeseen
                                difficulties. Should the contest duration be altered, every attempt will be made to notify contestants in a timely and
                                uniform manner.
                            </span> <span id="delete_edit">
                                <img id="edit" src="~/image/pencil-fill.svg" />
                                <img id="delete" src="~/image/trash-fill.svg" />
                            </span>
                        </div>
                    </div>*@
            </div>
        </div>
    </div>
</div>

<script>
    window.onload = () => {

        //for CKeditor
        CKEDITOR.replace('editor');
        timer = setInterval(updateDiv, 100);
        var data = "";
        function updateDiv() {
            data = CKEDITOR.instances.editor.getData();
        }


        var totalnodes = 6;
        document.querySelector('.save_btn').onclick = () => {
            document.getElementById('close').style.display = 'none';
            var item = document.createElement("div");
            var span1 = document.createElement("span");
            var span2 = document.createElement("span");
            var span3 = document.createElement("span");
            var edit = document.createElement('img');
            var delete_ = document.createElement('img');

            var subcons = document.querySelector('.container').children;
            var placingAddress = totalnodes + 1;

            var heading = document.querySelector('.heading').value;
            var contents = CKEDITOR.instances.editor.getData();
            AjaxCreateContent(heading, contents);
            document.querySelector('.input').style.height = 4.2 + 'rem';
            document.querySelector('.input').style.position = 'initial';
            document.querySelector('.input').style.zIndex = 1;
            document.querySelector('.container').style.opacity = 100 + '%';
            document.querySelector('.heading').value = '';
            CKEDITOR.instances.editor.setData('');
            document.querySelector('.save_btn').style.display = 'initial';
            document.querySelector('.update_btn').style.display = 'none';
            document.querySelector('.heading').placeholder = 'Take a Note...';
            document.querySelector('.heading').style.borderBottom = '0px solid black';
            document.getElementById('close').style.display = 'none';
            GetListContent();
            //function putdata(arg) {
            //    item.className = "item";

            //    span1.id = "haading";
            //    span1.style.fontSize = '1.5em';
            //    span1.style.fontWeight = 'bold';
            //    span1.innerHTML = heading;
            //    document.querySelector('.heading').value = '';

            //    span2.id = "content";
            //    data = CKEDITOR.instances.editor.getData();
            //    span2.innerHTML = data;
            //    CKEDITOR.instances.editor.setData('');

            //    span3.id = "delete_edit";

            //    edit.id = "edit";
            //    edit.src = "/image/pencil-fill.svg";


            //    delete_.id = "delete";
            //    delete_.src = "/image/trash-fill.svg";

            //    span3.appendChild(edit);
            //    span3.appendChild(delete_);

            //    item.appendChild(span1);
            //    item.appendChild(span2);
            //    item.appendChild(span3);

            //    //subcons[arg].appendChild(item);
            //    totalnodes += 1;

            //    document.querySelector('.input').style.height = 4.2 + 'rem';
            //    document.querySelector('.heading').placeholder = 'Take a Note...';
            //    document.querySelector('.heading').style.borderBottom = '0px solid black';
            //    document.querySelector('.input').style.position = 'initial';
            //    document.querySelector('.container').style.opacity = 100 + '%';

            //    //adding functionality to the edit button
            //    //var edit_btns = document.querySelectorAll("#edit");
            //    //edit_btns.forEach(btns => btns.onclick = (e) => {
            //    //    document.querySelector('.save_btn').style.display = 'none';
            //    //    document.querySelector('.update_btn').style.display = 'initial';
            //    //    document.querySelector('.input').style.height = 'fit-content';
            //    //    document.querySelector('.input').style.position = 'absolute';
            //    //    document.querySelector('.input').style.zIndex = 5;
            //    //    document.querySelector('.container').style.opacity = 10 + '%';
            //    //    document.querySelector('.heading').placeholder = 'Heading';
            //    //    document.querySelector('.heading').style.borderBottom = '2px solid black';

            //    //    document.querySelector('.heading').value = e.target.parentElement.parentElement.firstElementChild.innerHTML;
            //    //    CKEDITOR.instances.editor.setData(e.target.parentElement.parentElement.firstElementChild.nextElementSibling.innerHTML);

            //    //    document.querySelector('.update_btn').onclick = () => {
            //    //        e.target.parentElement.parentElement.firstElementChild.innerHTML = document.querySelector('.heading').value;
            //    //        document.querySelector('.heading').value = '';
            //    //        e.target.parentElement.parentElement.firstElementChild.nextElementSibling.innerHTML = CKEDITOR.instances.editor.getData();
            //    //        CKEDITOR.instances.editor.setData('');
            //    //        document.querySelector('.save_btn').style.display = 'initial';
            //    //        document.querySelector('.update_btn').style.display = 'none';
            //    //        document.querySelector('.input').style.height = 4.2 + 'rem';
            //    //        document.querySelector('.input').style.position = 'initial';
            //    //        document.querySelector('.input').style.zIndex = 1;
            //    //        document.querySelector('.container').style.opacity = 100 + '%';
            //    //        document.querySelector('.heading').value = '';
            //    //        document.querySelector('.heading').placeholder = 'Take a Note...';
            //    //        document.querySelector('.heading').style.borderBottom = '0px solid black';
            //    //    }
            //    //});

            //    //adding functionality to the delete button
            //    //var delete_btns = document.querySelectorAll("#delete");
            //    //delete_btns.forEach(btns => btns.onclick = (e) => {
            //    //    e.target.parentElement.parentElement.parentElement.removeChild(e.target.parentElement.parentElement);
            //    //});

            //}

            //if (data.length !== 0) {
            //    for (let i = placingAddress; i > 0; i--) {
            //        if (i - 5 == 1 || i - 10 == 1 || i - 15 == 1 || i - 20 == 1) {
            //            putdata(0);
            //            break;
            //        }
            //        else if (i - 5 == 2 || i - 10 == 2 || i - 15 == 2 || i - 20 == 2) {
            //            putdata(1);
            //            break;
            //        }
            //        else if (i - 5 == 3 || i - 10 == 3 || i - 15 == 3 || i - 20 == 3) {
            //            putdata(2);
            //            break;
            //        }
            //        else if (i - 5 == 4 || i - 10 == 4 || i - 15 == 4 || i - 20 == 4) {
            //            putdata(3);
            //            break;
            //        }
            //        else if (i - 5 == 5 || i - 10 == 5 || i - 15 == 5 || i - 20 == 5) {
            //            putdata(4);
            //            break;
            //        }
            //    }
            //}

        }

        document.querySelector('.heading').onclick = () => {
            document.getElementById('close').style.display = 'initial';
            document.querySelector('.input').style.height = 'fit-content';
            document.querySelector('.input').style.position = 'absolute';
            document.querySelector('.input').style.zIndex = 5;
            document.querySelector('.container').style.opacity = 10 + '%';

            document.querySelector('.heading').placeholder = 'Heading';
            document.querySelector('.heading').style.borderBottom = '2px solid black';
        }

        document.getElementById('close').onclick = () => {
            document.querySelector('.input').style.height = 4.2 + 'rem';
            document.querySelector('.input').style.position = 'initial';
            document.querySelector('.input').style.zIndex = 1;
            document.querySelector('.container').style.opacity = 100 + '%';
            document.querySelector('.heading').value = '';
            CKEDITOR.instances.editor.setData('');
            document.querySelector('.save_btn').style.display = 'initial';
            document.querySelector('.update_btn').style.display = 'none';
            document.querySelector('.heading').placeholder = 'Take a Note...';
            document.querySelector('.heading').style.borderBottom = '0px solid black';
            document.getElementById('close').style.display = 'none';
        }


        //adding functionality to the edit button
        var edit_btns = document.querySelectorAll("#edit");
        edit_btns.forEach(btns => btns.onclick = (e) => {
            document.getElementById('close').style.display = 'initial';
            document.querySelector('.save_btn').style.display = 'none';
            document.querySelector('.update_btn').style.display = 'initial';
            document.querySelector('.input').style.height = 'fit-content';
            document.querySelector('.input').style.position = 'absolute';
            document.querySelector('.input').style.zIndex = 5;
            document.querySelector('.container').style.opacity = 10 + '%';
            document.querySelector('.heading').placeholder = 'Heading';
            document.querySelector('.heading').style.borderBottom = '2px solid black';

            var title = document.getElementById('page-title').innerHTML;
            var content = document.getElementById('page-content0').innerHTML;

            document.querySelector('.heading').value = title;
            CKEDITOR.instances.editor.setData(content);

            document.querySelector('.update_btn').onclick = () => {
                e.target.parentElement.parentElement.firstElementChild.innerHTML = document.querySelector('.heading').value;
                document.querySelector('.heading').value = '';
                e.target.parentElement.parentElement.firstElementChild.nextElementSibling.innerHTML = CKEDITOR.instances.editor.getData();
                CKEDITOR.instances.editor.setData('');
                document.querySelector('.save_btn').style.display = 'initial';
                document.querySelector('.update_btn').style.display = 'none';
                document.querySelector('.input').style.height = 4.2 + 'rem';
                document.querySelector('.input').style.position = 'initial';
                document.querySelector('.input').style.zIndex = 1;
                document.querySelector('.container').style.opacity = 100 + '%';
                document.querySelector('.heading').placeholder = 'Take a Note...';
                document.querySelector('.heading').style.borderBottom = '0px solid black';
                document.getElementById('close').style.display = 'none';
            }
        });



        //adding functionality to the delete button
        var delete_btns = document.querySelectorAll("#delete");
        delete_btns.forEach(btns => btns.onclick = (e) => {
            e.target.parentElement.parentElement.parentElement.removeChild(e.target.parentElement.parentElement);
        });
    }
</script>

<script>

    GetListContent();
    function GetListContent() {
        document.getElementById("page-content").innerHTML = "";
        $.ajax({
            url: '@Url.Action("GetContentRule", "Home")',
            type: 'GET',
            success: function (results) {
                if (results != null) {
                    for (let i = 0; i < results.length; i++) {
                        console.log("" + results[i].content);
                        document.getElementById("page-content").innerHTML +=
                            `<div class="col-lg-12" id="content-item">
                                            <div class="Event-Schedule" id="page-title" content-id="`+ results[i].content_id + `" page-id="` + results[i].page_id + `" content-position="` + results[i].position +`">
                                                `+ results[i].title+`
                                            </div>
                                            <div class="Event-Content" id="page-content0">
                                                `+ results[i].content +`
                                            </div>
                                            <div class="col-lg-12" id="delete_edit">
                                                <button class="btn-sm btn-warning" id="edit">Edit</button>
                                                <button class="btn-sm btn-primary" onclick="AjaxPinContentById(this)" >Pin</button>
                                                <button class="btn-sm btn-success" onclick="AjaxUpdateContentById(this)" >Update</button>
                                                <button class="btn-sm btn-danger" onclick="AjaxDeleteContentById(this)" >Delete</button>
                                            </div>
                                       </div>`;
                    }
                }
            }
        });
    };

    //<img id="edit" src="/image/pencil-fill.svg" />
    //                            <img id="pin" src="/image/pencil-fill.svg" />
    //                            <img id="delete" src="/image/trash-fill.svg" />
    //.split(/\s+/)
    function AjaxSaveListContent() {
        var pageContent = document.getElementById('page-content');
        let lstContent = [];
        if (pageContent.childElementCount > 0) {
            for (var i = 0; i < pageContent.childElementCount; i++) {
                var classList = pageContent.children[i];
                var _content_id = classList.children[0].getAttribute("content-id");
                var _page_id = classList.children[0].getAttribute("page-id");
                var _title = classList.children[0].innerHTML;
                var _content = classList.children[1].innerHTML;

                let objectContent = {
                    content_id : _content_id,
                    title : _title,
                    content: _content,
                    page_id: _page_id,
                    position : i
                };
                lstContent.push(objectContent);
            }
        }
        console.log("id= " + lstContent[0].id + " title= " + lstContent[0].title + "content= " + lstContent[0].content + "position= " + lstContent[0].position);

        $.ajax({
             type: "POST",
            url: '@Url.Action("UpdateListContent", "Home")',
            data: JSON.stringify(lstContent),
             dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (rs) {
                if (rs.Result == true) {
                    alert("success");
                 } else {
                     alert("fail");
                }
             }
        });
        GetListContent();
    };

    function AjaxUpdateContentById(e) {
        var crrItem = e.parentElement.parentElement;
        var _content_id = crrItem.children[0].getAttribute("content-id");
        var _page_id = crrItem.children[0].getAttribute("page-id");
        var _content_position = crrItem.children[0].getAttribute("content-position");
        var _title = crrItem.children[0].innerHTML;
        var _content = crrItem.children[1].innerHTML;

         let objectContent = {
             content_id: _content_id,
             title: _title,
             content: _content,
             page_id: _page_id,
             position: _content_position
         };

        console.log("id= " + objectContent.id + " title= " + objectContent.title + "content= " + objectContent.content);

         $.ajax({
             type: "POST",
            url: '@Url.Action("UpdateSingleContent", "Home")',
             data: JSON.stringify(objectContent),
             dataType: "json",
             contentType: "application/json; charset=utf-8",
             success: function (rs) {
                if (rs.Result == true) {
                    alert("success");
                 } else {
                     alert("fail");
                 }
             }
        });
        GetListContent();
    };

    function AjaxDeleteContentById(e) {

        if (confirm("DELETE this Content ???") == true) {
            var crrItem = e.parentElement.parentElement;
            var _content_id = crrItem.children[0].getAttribute("content-id");
            var _page_id = crrItem.children[0].getAttribute("page-id");
            var _content_position = crrItem.children[0].getAttribute("content-position");
            var _title = crrItem.children[0].innerHTML;
            var _content = crrItem.children[1].innerHTML;

            let objectContent = {
                content_id: _content_id,
                title: _title,
                content: _content,
                page_id: _page_id,
                position: _content_position
            };

            console.log("id= " + objectContent.id + " title= " + objectContent.title + "content= " + objectContent.content);

            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteSingleContent", "Home")',
                data: JSON.stringify(objectContent),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (rs) {
                    var s = rs;
                    if (rs.Result == true) {
                        alert("success");
                    } else {
                        alert("fail");
                    }
                }
            });
            GetListContent();
        }
    };

     @*function AjaxPinContentById(e) {
         //step 1: get all content list and sort
         //step 2: check if id == content-id => add the first
         //step 3: add all content in list

        if (confirm("PIN this Content ???") == true) {
            var crrItem = e.parentElement.parentElement;
            var _content_id = crrItem.children[0].getAttribute("content-id");
            var _content_position = crrItem.children[0].getAttribute("content-position");
            var _page_id = crrItem.children[0].getAttribute("page-id");
            var _title = crrItem.children[0].innerHTML;
            var _content = crrItem.children[1].innerHTML;

            let objectContent = {
                content_id: _content_id,
                title: _title,
                content: _content,
                page_id: _page_id,
                position: _content_position
            };

            console.log("id= " + objectContent.id + " title= " + objectContent.title + "content= " + objectContent.content);

            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteSingleContent", "Home")',
                data: JSON.stringify(objectContent),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (rs) {
                    var s = rs;
                    if (rs.Result == true) {
                        alert("success");
                    } else {
                        alert("fail");
                    }
                }
            });
            GetListContent();
        }
    };*@

    function AjaxCreateContent(_title, _content) {

        let objectContent = {
            title: _title,
            content: _content,
            page_id: "RULE",
            position: 0
        };

        $.ajax({
                type: "POST",
                url: '@Url.Action("CreatePageContent", "Home")',
                data: JSON.stringify(objectContent),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (rs) {
                    var s = rs;
                    if (rs.Result == true) {
                        alert("success");
                    } else {
                        alert("fail");
                    }
                }
            });

    };

</script>