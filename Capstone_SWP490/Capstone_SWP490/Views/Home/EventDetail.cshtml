@{
    ViewBag.Title = "Event | Detail";
    var events = ViewData["Events"] as Capstone_SWP490.Models.events_ViewModel.eventsViewModel;
    var subEvents = ViewData["SubEvents"] as List<Capstone_SWP490.Models.events_ViewModel.eventsViewModel>;
    var member = ViewData["Members"] as Capstone_SWP490.member;
    var profile = Session["profile"] as Capstone_SWP490.Models.app_userViewModel.app_userViewModel;
}
<style>
    #menu_Schedule {
        color: #ffffff !important;
        background: #30cf6b;
    }

    .venue-table {
        width: 135px;
    }

    .date-table {
        width: 135px;
    }

    .action-table {
        width: 70px;
    }

    .join-event {
        width: 100px;
    }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<div class="container-fluid xyz">
    <div class="col-lg-12" id="content_area2_header">
        <div class="col-lg-12" id="content_area2_title">
            <label for="exampleInputTitle">Event Detail</label>
        </div>
    </div>
    <div class="main">
        <div class="row">
            <div class="col-lg-10 col-lg-offset-1" id="under">
                @if (events != null)
                {
                    <section>
                        <div class="form-group" style="padding-left:15px">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li role="presentation" class="nav-item active">
                                    <a href="#step1" class="nav-link front-size-title active" data-toggle="tab" aria-controls="step1" role="tab" title="Step 1">About the Event</a>
                                </li>

                                <li role="presentation" class="nav-item">
                                    <a href="#step2" class="nav-link front-size-title" data-toggle="tab" aria-controls="step2" role="tab" title="Step 2">Description</a>
                                </li>
                                <li role="presentation" class="nav-item">
                                    <a href="#step3" class="nav-link front-size-title" data-toggle="tab" aria-controls="step3" role="tab" title="Step 3">Contact</a>
                                </li>

                            </ul>
                        </div>
                        <form role="form">
                            <div class="tab-content">

                                <div class="tab-pane active" role="tabpanel" id="step1">
                                    <div class="col-lg-12">
                                        <label class="border border-danger" for="Event_Schedule">
                                            Title:
                                        </label>
                                        <label class="border border-danger" for="Event_Schedule" style="font-weight: normal">
                                            @events.title
                                        </label>
                                    </div>
                                    <div class="col-lg-12">
                                        <label class="border border-danger" for="Event_Schedule">
                                            Time start:
                                        </label>
                                        <label class="border border-danger" for="Event_Schedule" style="font-weight: normal">
                                            @events.start_date_str.Split(',')[0]
                                        </label>
                                    </div>
                                    <div class="col-lg-12">
                                        <label class="border border-danger" for="Event_Schedule">
                                            Time end:
                                        </label>
                                        <label class="border border-danger" for="Event_Schedule" style="font-weight: normal">
                                            @events.end_date_str.Split(',')[0]
                                        </label>
                                    </div>
                                </div>

                                <div class="tab-pane" role="tabpanel" id="step2">
                                    <div class="col-lg-12">
                                        <label class="border border-danger" for="Event_Schedule">
                                            Desctiption:
                                        </label>
                                        <label class="border border-danger" for="Event_Schedule" style="font-weight: normal">
                                            @events.desctiption
                                        </label>
                                    </div>
                                    <div class="col-lg-12">
                                        <label class="border border-danger" for="Event_Schedule">
                                            Venue:
                                        </label>
                                        <label class="border border-danger" for="Event_Schedule" style="font-weight: normal">
                                            @events.venue
                                        </label>
                                    </div>
                                </div>
                                <div class="tab-pane" role="tabpanel" id="step3">
                                    <div class="col-lg-12">
                                        <label class="border border-danger" for="Event_Schedule">
                                            Contactor phone:
                                        </label>
                                        <label class="border border-danger" for="Event_Schedule" style="font-weight: normal">
                                            @events.contactor_phone
                                        </label>
                                    </div>
                                    <div class="col-lg-12">
                                        <label class="Event-Title" for="Event_Schedule">
                                            Contactor email:
                                        </label>
                                        <label class="Event-Content" for="Event_Schedule" style="font-weight: normal">
                                            @events.contactor_email
                                        </label>
                                    </div>
                                    <div class="col-lg-12">
                                        <label class="Event-Title" for="Event_Schedule">
                                            Contactor Name:
                                        </label>
                                        <label class="Event-Content" for="Event_Schedule" style="font-weight: normal">
                                            @events.contactor_name
                                        </label>
                                    </div>
                                    <div class="col-lg-12">
                                        <label class="Event-Title" for="Event_Schedule">
                                            Fanpage:
                                        </label>
                                        <label class="Event-Content" for="Event_Schedule" style="font-weight: normal">
                                            <a href="#">@events.fan_page</a>
                                        </label>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </form>
                    </section>
                    if (Session["username"] != null)
                    {
                        if (profile.user_role.Equals("ORGANIZER"))
                        {
                            <div class="col-lg-12">
                                <button type="button" id="btn-add-event" onclick="window.location.href = '/Home/SubEventUpload?id=@events.event_id'" class="btn btn-success">Add Sub Event</button>
                            </div>
                        }
                    }
                    <div class="col-lg-12" id="under">
                        <table class="table table-striped table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Time Start</th>
                                    <th scope="col">Time End</th>
                                    <th scope="col">Location</th>
                                    <th scope="col">Title</th>
                                    @if (Session["username"] != null)
                                    {
                                        if (profile.user_role.Equals("ORGANIZER"))
                                        {
                                            <th scope="col"></th>
                                            <th scope="col"></th>
                                            <th scope="col"></th>
                                        }
                                    }
                                </tr>
                            </thead>
                            <tbody id="table-events">
                                @if (subEvents != null && subEvents.Count > 0)
                                {
                                    foreach (var x in subEvents)
                                    {
                                        <tr>
                                            <td class="date-table">@x.start_date_str</td>
                                            <td class="date-table">@x.end_date_str</td>
                                            <td class="venue-table">@x.venue</td>
                                            <td class="title-table">@x.title</td>
                                            @if (Session["username"] != null)
                                            {
                                                if (profile.user_role.Equals("ORGANIZER"))
                                                {
                                                    <td class="action-table"><a href="/Home/EventEdit?id=@x.event_id">Edit</a></td>
                                                    <td class="action-table"><a href="/Home/SubEventDetail?id=@x.event_id">Detail</a></td>
                                                    <td class="action-table"><a href="/Home/EventDelete?id=@x.event_id">Delete</a></td>
                                                }
                                                else if (profile.user_role.Equals("MEMBER"))
                                                {
                                                    @*
                                                        Event cho phep Join hay khong
                                                    *@
                                                    if (x.status == 1)
                                                    {
                                                        if (x.is_user_joined)
                                                        {
                                                            <td class="join-event">
                                                                <button class="btn-sm btn-secondary" disabled>
                                                                    Joined
                                                                </button>
                                                            </td>
                                                        }
                                                        else
                                                        {
                                                            <td class="join-event">
                                                                <button class="btn-sm btn-success" sub-event-id="@x.event_id" onclick="JoinSubEvent(this)">
                                                                    Join Now
                                                                </button>
                                                            </td>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <td class="join-event"></td>
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                <td class="action-table"><a href="/Home/SubEventDetail?id=@x.event_id">Detail</a></td>
                                            }
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr><td><i>No Sub event</i></td></tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="col-lg-12">
                        <button type="button" id="btn-cancel-event" onclick="history.back()" class="btn btn-secondary">Back</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="userss" value="@Session["username"]">
@if (Session["username"] != null)
{
    <input type="hidden" id="user_role" value="@profile.user_role">
    <input type="hidden" id="user_id" value="@profile.user_id">
}
else
{
    <input type="hidden" id="user_role" value="0">
    <input type="hidden" id="user_id" value="0">
}

<script>

    function JoinEvent(e) {
        var x = $(e).attr("member-id");
        $.ajax({
            type: 'POST',
            url: '@Url.Action("JoinEvent", "Home")',
            data: JSON.stringify({ 'userId': x }),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (rs) {
                if (rs != null) {
                    var s = rs;
                    if (rs.Status == 1) {
                        alert("Join Event Successfully!!!");
                        location.reload();
                    } else {
                        alert("Fail");
                    }
                }
            }
        });
    }

    function JoinSubEvent(e) {
        var _subEventId = $(e).attr("sub-event-id");
        var _userId = $("#user_id").val();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("JoinSubEvent", "Home")',
            data: JSON.stringify({ 'subEvent': _subEventId, 'userCrr': _userId }),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (rs) {
                if (rs != null) {
                    var s = rs;
                    if (rs.Status == 1) {
                        alert("Join Event Successfully!!!");
                        location.reload();
                    } else {
                        alert("Fail");
                    }
                }
            }
        });
    }

</script>
